/*!
 * @license
 * Palikka v1.0.0-beta
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2016 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(e,n){"function"==typeof define&&define.amd?define([],function(){return n(e)}):"object"==typeof module&&module.exports?module.exports=n(e):e.Palikka=n(e)}(this,function(e,n){"use strict";function t(e,t,r,u){function d(e){e&&"function"==typeof e.then?e.then(f,f):f(e)}function f(n){l.ready=!0,l.value=n;for(var r=e._queues,o=r[t]=(r[t]||[]).slice(0),i=0;i<o.length;i++)o[i](l)}function c(){if("function"==typeof u){var n=!1,r=function(e){n=!0,e(function(e){d(e)})},o=function(n){return i.call(e,n)},f=u(o,r,t);n||d(f)}else d(u)}var l=this;if(t&&"string"==typeof t||a(p),!e._modules[t]){for(var s=0;s<r.length;s++){var h=r[s],v=e._modules[h];h&&"string"==typeof h||a(p),h===t&&a("Module cannot have itself as a dependency."),v&&v.dependencies.indexOf(t)>-1&&a("Circular dependency between "+t+" and "+h+".")}l.id=t,l.order=++e._counter,l.dependencies=r,l.ready=!1,l.value=n,e._modules[t]=l,r.length?o.call(e,r,c):c()}}function r(){this._modules={},this._queues={},this._counter=0}function o(e,n){for(var t=this,r=[].concat(e),o=r.length,i=0,u=0;u<r.length;u++){var d=r[u];d&&"string"==typeof d||a(p);var f=t._modules[d];if(f&&f.ready)++i===o&&n();else{var c=t._queues,l=c[d]=c[d]||[];l[l.length]=function(){++i===o&&n()}}}}function i(e){e&&"string"==typeof e||a(p);var n=this._modules[e];return n&&n.ready||a("Required module "+e+" is not ready."),n.value}function u(e){return{id:e.id,order:e.order,dependencies:e.dependencies,ready:e.ready,value:e.value}}function d(e,n){for(var t="",r=e&&"function"!=typeof e?e:null,o="function"==typeof e?e:"function"==typeof n?n:f,i=this._modules,d=(r?[].concat(r):Object.keys(i)).filter(function(e){return i[e]}).map(function(e){return u(i[e])}).sort(function(e,n){return e.order<n.order?-1:e.order>n.order?1:0}),a=0;a<d.length;a++){var c=d[a],p=c.ready?l:s;t+=o(c.id,null,p);for(var v=0;v<c.dependencies.length;v++){var y=c.dependencies[v],g=i[y],m=g?g.ready?l:s:h;t+=o(y,c.id,m)}}return t}function f(e,n,t){return(n?"    -> ":"")+v[t]+" "+e+"\n"}function a(e){throw new Error("[Palikka] "+e)}var c=new r,l="defined",s="instantiated",h="undefined",p="Module id must be a non-empty string.",v={defined:"[v]",instantiated:"[-]",undefined:"[x]"};return r.define=function(e,n,t){var o=arguments.length;return o>2?c.define(e,n,t):o>1?c.define(e,n):c.define(e),r},r.require=function(e,n){return c.require(e,n),r},r.log=function(e,n){return c.log(e,n)},r.data=function(){return c.data()},r.prototype.define=function(e,n,r){var o=arguments.length>2,e=[].concat(e),i=o?[].concat(n):[],r=o?r:n;e.length||a("define method must have id(s).");for(var u=0;u<e.length;u++)new t(this,e[u],i,r);return this},r.prototype.require=function(e,n){var t=this;return e=[].concat(e),e.length||a("require method must have id(s)."),"function"!=typeof n&&a("require method must have a callback function."),o.call(t,e,function(){n(function(e){return i.call(t,e)})}),t},r.prototype.log=function(e,n){return d.call(this,e,n)},r.prototype.data=function(){for(var e=this._modules,n=Object.keys(e),t={},r=0;r<n.length;r++)t[n[r]]=u(e[n[r]]);return t},r});