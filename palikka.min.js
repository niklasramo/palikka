/*!
 * @license
 * Palikka v0.4.1
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2015 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(e){"use strict";function n(e){this._listeners=k(e,P)?e:{}}function t(e,t){var r=new n(t);return k(e,P)?(e.on=r.on,e.one=r.one,e.off=r.off,e.emit=r.emit,e._listeners=r._listeners,e):r}function r(n){var t=this;t._locked=!1,t._result=e,t._state=C,t._async=L.asyncDeferreds,t._fulfilled=[],t._rejected=[],k(n,K)&&n(function(e){t.resolve(e)},function(e){t.reject(e)})}function i(e){return new r(e)}function o(e,n){n===e?s(e,TypeError("A promise can not be resolved with itself.")):n instanceof r?n.onFulfilled(function(n){c(e,n)}).onRejected(function(n){s(e,n)}):k(n,K)||k(n,P)?u(e,n):c(e,n)}function u(e,n){try{var t,r=n.then;if(k(r,K))try{r.call(n,function(n){t||(t=1,o(e,n))},function(n){t||(t=1,s(e,n))})}catch(i){t||s(e,i)}else c(e,n)}catch(i){s(e,i)}}function c(e,n){e._result=n,e._state=q,f(e,"_"+q)}function s(e,n){e._result=n,e._state=I,f(e,"_"+I)}function f(e,n){e[n].length&&(b(j(e[n]),function(e){e()}),e._fulfilled=[],e._rejected=[])}function l(e,n,t){return k(n,K)&&(e._state===t&&a(e,n),e._state===C&&e["_"+t].push(function(){a(e,n)})),e}function a(e,n){E(function(){n(e._result)},e._async)}function d(e,n,t,r){var o,u,c=i();return e.onSettled(function(i){o=e._state===q,n=o&&k(n,K)?n:0,t=!o&&k(t,K)?t:0,u=n||t||0,u||o?F(function(){c.resolve(u?r&&k(i,W)?u.apply(r,i):u(i):i)},function(e){c.reject(e)}):c.reject(i)}),c}function h(n,t,o){w(n,W),t=t===!0,o=o===e||o===!0;var u,c=i(),s=[],f=[],l=n.length;return l?b(n,function(e,n){e=e instanceof r?e:i().resolve(e),e.onSettled(function(){c.state()!==C||c.isLocked()||(--l,u=u||e.state()===I&&e,s[n]=e.result(),f[n]=e.inspect(),!u||!o&&l||c.reject(o?u.result():f),u||!t&&l||c.resolve(t?s[n]:s))})}):c.resolve(s),c}function p(e,n,t){var r=this,o=i().sync();r.id=e,r.dependencies=n,r.deferred=o,R[e]=r,o.onFulfilled(function(){S.emit(z+e,[r])}),_(n,function(n,r){o.resolve(k(t,K)?t.apply({id:e,dependencies:r},n):t)})}function v(e,n,t){var r,i,o=arguments.length>2;return w(e,W+"|"+H),e=k(e,W)?e:[e],o?(w(n,W+"|"+H),r=k(n,W)?n:[n]):r=[],t=o?t:n,w(t,K+"|"+P),b(e,function(e){if(w(e,H),!e)throw Error("Module must have an id.");if(R[e])throw Error("Module "+e+" is already defined.");if(o&&r.length&&(i=m(e,r)))throw Error("Circular dependency between "+e+" and "+i+".");new p(e,r,t)}),D}function y(e,n){return w(n,K),w(e,W+"|"+H),e=k(e,W)?e:[e],_(e,function(e,t){n.apply({dependencies:t},e)}),D}function _(e,n){var t=[],r={};b(e,function(e){w(e,H),t.push(R[e]?R[e].deferred:i(function(n){S.one(z+e,function(e,t){n(t.deferred.result())})}).sync())}),h(t)[L.asyncModules?"async":"sync"]().onFulfilled(function(t){b(e,function(e,n){r[e]=t[n]}),n(t,r)})}function m(e,n){var t=null;return b(n,function(n){var r=R[n];return r&&b(r.dependencies,function(n){return t||n!==e?void 0:(t=r.id,1)}),t?1:void 0}),t}function g(){var e,n,t={};for(n in R)e=R[n],t[n]={id:n,dependencies:j(e.dependencies),ready:e.deferred.state()===q?!0:!1,value:e.deferred.result()};return t}function k(n,t){var r=null===n?"null":n===e?"undefined":typeof n;return r=r!==P?r:N.call(n).split(" ")[1].replace("]","").toLowerCase(),U||r!==P||(r=typeof n.callee===K&&n===n.callee.arguments?B:r),t?r===t:r}function w(e,n){var t=!1,r=n.split("|");if(b(r,function(n){t=t?t:k(e,n)}),!t)throw TypeError(e+" is not "+n)}function j(e){var n=k(e);return n===W?e.slice(0):n===B?Q.call(e):[]}function b(e,n){if(k(n,K))for(var t=0,r=e.length;r>t&&!n(e[t],t);t++);return e}function x(){var e,n,t,r,i,o,u,c=M(X.Promise);return c?(c=c.resolve(),u=function(e){c.then(e)}):V?u=X.setImmediate||process.nextTick:(e=M(X.MutationObserver)||M(X.WebKitMutationObserver),n=1,t=function(){n=1,T.emit(A)},r=function(){n&&(n=0,i())},e?(o=document.createElement("i"),new e(t).observe(o,{attributes:!0}),i=function(){o.id=""}):i=function(){X.setTimeout(t,0)},u=function(e){T.one(A,e),r()}),function(e){return k(e,K)&&u(e),D}}function E(e,n){n?Y(e):e()}function M(e){return k(e,K)&&e.toString().indexOf("[native")>-1&&e}function F(e,n){try{e()}catch(t){n(t)}}var S,T,O="palikka",D={},L={asyncDeferreds:!0,asyncModules:!0},R={},z="a",A="d",C="pending",q="fulfilled",I="rejected",K="function",P="object",W="array",B="arguments",G="number",H="string",J=0,N={}.toString,Q=[].slice,U=!this==!0,V=typeof process===P&&k(process,"process"),X=V?global:window,Y=x(),Z=n.prototype,$=r.prototype;Z.on=function(e,n,t){var r=this._listeners;return k(n,K)&&(r[e]=r[e]||[],r[e].push({id:++J,fn:n,ctx:t})),this},Z.one=function(e,n,t){var r=this;return r.on(e,function(e){r.off(e.type,e.id),n.apply(this,arguments)},t),r},Z.off=function(e,n){var t=this._listeners,r=t[e],i=r&&r.length;if(i)if(n)for(var o,u=k(n),c=u===G,s=u===K;i--;)o=r[i],(s&&n===o.fn||c&&n===o.id)&&r.splice(i,1);else delete t[e];return this},Z.emit=function(n,t,r){var i,o=this,u=o._listeners[n];return u&&b(j(u),function(u){k(u.fn,K)&&(i=j(t),i.unshift({type:n,id:u.id,fn:u.fn}),u.fn.apply(r!==e?r:u.ctx!==e?u.ctx:o,i))}),o},$.state=function(){return this._state},$.result=function(){return this._result},$.isAsync=function(){return this._async},$.isLocked=function(){return this._locked},$.inspect=function(){var e=this;return{state:e._state,result:e._result,locked:e._locked,async:e._async}},$.sync=function(){return this._async=!1,this},$.async=function(){return this._async=!0,this},$.resolve=function(e){var n=this;return n._state!==C||n._locked||(n._locked=!0,o(n,e)),n},$.reject=function(e){var n=this;return n._state!==C||n._locked||(n._locked=!0,s(n,e)),n},$.onFulfilled=function(e){return l(this,e,q)},$.onRejected=function(e){return l(this,e,I)},$.onSettled=function(e){return this.onFulfilled(e).onRejected(e)},$.then=function(e,n){return d(this,e,n)},$.spread=function(e,n){return d(this,e,n,1)},$.and=function(e,n,t){return e.unshift(this),h(e,n,t)},D.Eventizer=n,D.eventize=t,D.Deferred=r,D.defer=i,D.when=h,D.define=v,D.require=y,D.list=g,D.typeOf=k,D.nextTick=Y,D.config=L,S=t(),T=t(),typeof define===K&&define.amd?define([],D):typeof exports===P?module.exports=D:X[O]=D}();