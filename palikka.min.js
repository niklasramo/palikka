/*!
 * @license
 * Palikka v0.3.2-beta
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2015 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(e){"use strict";function n(e){this._listeners=e||{}}function t(e,t){var r=new n(t);return m(e,"object")?(e._listeners=r._listeners,e.on=r.on,e.one=r.one,e.off=r.off,e.emit=r.emit,e.emitAsync=r.emitAsync,e):r}function r(n){var t=this;t._id=++q,t._locked=!1,t._result=e,t._state=R,t._asynchronous=S.asyncDeferreds,m(n,"function")&&n(function(e){t.resolve(e)},function(e){t.reject(e)})}function o(e){return new r(e)}function i(e,n){n===e?f(e,TypeError("A promise can not be resolved with itself.")):n instanceof r?n.onFulfilled(function(n){c(e,n)}).onRejected(function(n){f(e,n)}):m(n,"function")||m(n,"object")?u(e,n):c(e,n)}function u(e,n){try{var t=n.then,r=0;if(m(t,"function"))try{t.call(n,function(n){r||(r=1,i(e,n))},function(n){r||(r=1,f(e,n))})}catch(o){r||f(e,o)}else c(e,n)}catch(o){f(e,o)}}function c(e,n){e._result=n,e._state=z,E.emit(O+e._id,[n])}function f(e,n){e._result=n,e._state=C,E.emit(D+e._id,[n])}function s(e,n,t,r){return m(n,"function")&&(e._state===t&&a(e,n),e._state===R&&E.one(r+e._id,function(){a(e,n)})),e}function a(e,n){k(function(){n(e.result())},e._asynchronous)}function l(n,t,i){t=t===!0,i=i===e||i===!0;var u,c=o(),f=[],s=n.length;return s?b(n,function(e,n){e=e instanceof r?e:o()._async(!1).resolve(e),e.onSettled(function(){"pending"!==c.state()||c._locked||(--s,u=u||"rejected"===e.state()&&e,f[n]=e.result(),!u||!i&&s||c.reject(u.result()),u||!t&&s||c.resolve(t?f[n]:f))})}):c.resolve(f),c}function d(e,n,t){var r,i,u=this,c=o()._async(!1);u._id=e,u._dependencies=n,u._deferred=c,T[e]=u,c.onFulfilled(function(){E.emit(A+"-"+e,[u])}),_(n,function(n,o){m(t,"function")?(r={id:e,dependencies:o},i=t.apply(r,n)):i=t,c.resolve(i)})}function p(e,n,t){var r,o,i=arguments.length>2;return g(e,"array|string"),e=m(e,"array")?e:[e],i?(g(n,"array|string"),r=m(n,"array")?n:[n]):r=[],t=i?t:n,g(t,"function|object"),b(e,function(e){if(g(e,"string"),!e)throw Error("Module must have an id.");if(T[e]instanceof d)throw Error("Module "+e+" is already defined.");if(i&&r.length&&(o=h(e,r)))throw Error("Circular dependency between "+e+" and "+o+".");new d(e,r,t)}),F}function y(e,n){return g(n,"function"),g(e,"array|string"),e=m(e,"array")?e:[e],_(e,function(e,t){n.apply({dependencies:t},e)}),F}function _(e,n){var t=[],r={};b(e,function(e){g(e,"string");var n=T[e];t.push(n?n._deferred:o(function(n){E.one(A+"-"+e,function(e,t){n(t._deferred.result())})})._async(S.asyncModules))}),l(t)._async(S.asyncModules).onFulfilled(function(t){b(e,function(e,n){r[e]=t[n]}),n(t,r)})}function h(e,n){var t=null;return b(n,function(n){var r=T[n];return r&&b(r._dependencies,function(n){return t||n!==e?void 0:(t=r._id,1)}),t?1:void 0}),t}function v(e){var n=null;if(e)e in T&&(n=T[e].info());else{n={};for(var t in T)n[t]=T[t].info()}return n}function m(n,t){var r=null===n?"null":n===e?"undefined":typeof n;return r="object"!==r?r:I.call(n).split(" ")[1].replace("]","").toLowerCase(),L||"object"!==r||(r="function"==typeof n.callee&&n===n.callee.arguments?"arguments":r),t?r===t:r}function g(e,n){var t=!1,o=n.split("|");if(b(o,function(n){t||(t="deferred"===n?e instanceof r:m(e,n))}),!t)throw TypeError(e+" is not "+n)}function j(e){var n=m(e);return"array"===n?e.slice(0):"arguments"===n?K.call(e):[]}function b(e,n){if(m(n,"function"))for(var t=0,r=e.length;r>t&&!n(e[t],t);t++);return e}function w(){var e,n,t,r,o,i,u=M(W.Promise);return u?(u=u.resolve(),function(e){u.then(e)}):P?W.setImmediate||process.nextTick:(e=M(W.MutationObserver)||M(W.WebKitMutationObserver),n=1,t=function(){n=1,E.emit("tick")},r=function(){n&&(n=0,o())},e?(i=document.createElement("i"),new e(t).observe(i,{attributes:!0}),o=function(){i.id=""}):o=function(){W.setTimeout(t,0)},function(e){E.one("tick",e),r()})}function k(e,n){n?B(e):e()}function M(e){return m(e,"function")&&e.toString().indexOf("[native")>-1&&e}var E,x="palikka",F={},S={asyncDeferreds:!0,asyncModules:!0},T={},A="initiate",O="resolve",D="reject",R="pending",z="fulfilled",C="rejected",q=0,I={}.toString,K=[].slice,L=!this==!0,P="object"==typeof process&&m(process,"process"),W=P?global:window,B=w();n.prototype.on=function(e,n){var t=this._listeners;return m(n,"function")&&(t[e]=t[e]||[],t[e].push({id:++q,type:e,fn:n})),this},n.prototype.one=function(e,n){var t=this;return t.on(e,function(e){t.off(e.type,e.id),n.apply(this,arguments)}),t},n.prototype.off=function(e,n){var t,r,o=this._listeners,i=m(n),u="number"===i,c="function"===i,f=o[e];if(f){for(r=f.length;r--;)t=f[r],(!n||c&&n===t.fn||u&&n===t.id)&&f.splice(r,1);f.length||delete o[e]}return this},n.prototype.emit=function(n,t,r){var o=this,i=o._listeners[n];return i&&b(j(i),function(n){if(m(n.fn,"function")){var i=j(t),u=r===e?o:r;i.unshift({id:n.id,type:n.type,fn:n.fn}),n.fn.apply(u,i)}}),o},n.prototype.emitAsync=function(e,n,t){var r=this;return k(function(){r.emit(e,n,t)},1),r},r.prototype._async=function(e){return this._asynchronous=e?!0:!1,this},r.prototype.state=function(){return this._state},r.prototype.result=function(){return this._result},r.prototype.resolve=function(e){var n=this;return n._state!==R||n._locked||(n._locked=!0,i(n,e)),n},r.prototype.reject=function(e){var n=this;return n._state!==R||n._locked||(n._locked=!0,f(n,e)),n},r.prototype.onFulfilled=function(e){return s(this,e,z,O)},r.prototype.onRejected=function(e){return s(this,e,C,D)},r.prototype.onSettled=function(e){return this.onFulfilled(e).onRejected(e)},r.prototype.then=function(e,n){var t,r,i=this,u=o();return i.onSettled(function(o){if(t=i.state()===z,e=t&&m(e,"function")?e:0,n=!t&&m(n,"function")?n:0,r=e||n||0,r||t)try{u.resolve(r?r(o):o)}catch(c){u.reject(c)}else u.reject(o)}),u},r.prototype.and=function(e,n,t){return e.unshift(this),l(e,n,t)},d.prototype.info=function(){var e=this;return{id:e._id,ready:e._deferred.state()===z,dependencies:j(e._dependencies),value:e._deferred.result()}},F.Eventizer=n,F.eventize=t,F.Deferred=r,F.defer=o,F.when=l,F.define=p,F.require=y,F._getModules=v,F._typeOf=m,F._nextTick=B,F._config=S,E=t(),"function"==typeof define&&define.amd?define([],F):"object"==typeof module&&"object"==typeof module.exports?module.exports=F:W[x]=F}();