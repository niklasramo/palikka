/*!
 * @license
 * Palikka v0.4.1
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2015 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(e){"use strict";function n(e){this._listeners=m(e,P)?e:{}}function t(e,t){var r=new n(t);return m(e,P)?(e.on=r.on,e.one=r.one,e.off=r.off,e.emit=r.emit,e._listeners=r._listeners,e):r}function r(n){var t=this;t._locked=!1,t._result=e,t._state=O,t._async=L.asyncDeferreds,t._handlers=[],m(n,C)&&n(function(e){t.resolve(e)},function(e){t.reject(e)})}function i(e){return new r(e)}function o(e,n){n===e?u(e,TypeError("A promise can not be resolved with itself."),F):n instanceof r?n.onSettled(function(t){u(e,t,n._state)}):m(n,C)||m(n,P)?s(e,n):u(e,n,D)}function s(e,n){try{var t,r=n.then;if(m(r,C))try{r.call(n,function(n){t||(t=1,o(e,n))},function(n){t||(t=1,u(e,n,F))})}catch(i){t||(t=1,u(e,i,F))}else u(e,n,D)}catch(i){u(e,i,F)}}function u(e,n,t){e._result=n,e._state=t;var r=e._handlers.length;r&&w(e._handlers.splice(0,r),function(n){n.type&&n.type!==t||f(e,n.fn)})}function c(e,n,t){return m(n,C)&&(e._state===O?e._handlers.push({type:t,fn:n}):t&&e._state!==t||f(e,n)),e}function f(e,n){e._async?N(function(){n(e._result)}):n(e._result)}function l(e,n,t,r){var o,s,u=i();return e.onSettled(function(i){o=e._state===D,n=o&&m(n,C)?n:0,t=!o&&m(t,C)?t:0,s=n||t||0,s||o?x(function(){u.resolve(s?r&&m(i,q)?s.apply(r,i):s(i):i)},function(e){u.reject(e)}):u.reject(i)}),u}function a(n,t,o){g(n,q),t=t===!0,o=o===e||o===!0;var s,u=i(),c=[],f=[],l=n.length;return l?w(n,function(e,n){e=e instanceof r?e:i().resolve(e),e.onSettled(function(){u.state()!==O||u.isLocked()||(--l,s=s||e.state()===F&&e,c[n]=e.result(),f[n]=e.inspect(),!s||!o&&l||u.reject(o?s.result():f),s||!t&&l||u.resolve(t?c[n]:c))})}):u.resolve(c),u}function d(e,n,t){var r=this,o=i().sync();r.id=e,r.dependencies=n,r.deferred=o,z[e]=r,v(n,function(n,i){o.resolve(m(t,C)?t.apply({id:e,dependencies:i},n):t).onFulfilled(function(){E.emit(A+e,[r])})})}function h(e,n,t){var r,i,o=arguments.length>2;return g(e,q+"|"+R),e=m(e,q)?e:[e],o?(g(n,q+"|"+R),r=m(n,q)?n:[n]):r=[],t=o?t:n,g(t,C+"|"+P),w(e,function(e){if(g(e,R),!e)throw Error("Module must have an id.");if(z[e])throw Error("Module "+e+" is already defined.");if(o&&r.length&&(i=y(e,r)))throw Error("Circular dependency between "+e+" and "+i+".");new d(e,r,t)}),M}function p(e,n){return g(n,C),g(e,q+"|"+R),e=m(e,q)?e:[e],v(e,function(e,t){n.apply({dependencies:t},e)}),M}function v(e,n){var t=[],r={};w(e,function(e){g(e,R),t.push(z[e]?z[e].deferred:i(function(n){E.one(A+e,function(e,t){n(t.deferred.result())})}).sync())}),a(t)[L.asyncModules?"async":"sync"]().onFulfilled(function(t){w(e,function(e,n){r[e]=t[n]}),n(t,r)})}function y(e,n){var t=null;return w(n,function(n){var r=z[n];return r&&w(r.dependencies,function(n){return t||n!==e?void 0:(t=r.id,1)}),t?1:void 0}),t}function _(){var e,n,t={};for(n in z)e=z[n],t[n]={id:n,dependencies:k(e.dependencies),ready:e.deferred.state()===D?!0:!1,value:e.deferred.result()};return t}function m(n,t){var r=null===n?"null":n===e?"undefined":typeof n;return r=r!==P?r:W.call(n).split(" ")[1].replace("]","").toLowerCase(),G||r!==P||(r=typeof n.callee===C&&n===n.callee.arguments?I:r),t?r===t:r}function g(e,n){var t=!1,r=n.split("|");if(w(r,function(n){t=t?t:m(e,n)}),!t)throw TypeError(e+" is not "+n)}function k(e){var n=m(e);return n===q?e.slice(0):n===I?B.call(e):[]}function w(e,n){if(m(n,C))for(var t=0,r=e.length;r>t&&!n(e[t],t);t++);return e}function b(){var e,n,t=j(J.Promise)&&J.Promise.resolve(),r=H&&(process.nextTick||J.setImmediate),i=j(J.MutationObserver)||j(J.WebKitMutationObserver),o=[],s=0,u=function(e){return m(e,C)&&(o.push(e),s||(s=1,n())),M},c=function(){s=0,w(o.splice(0,o.length),function(e){e()})};return t?n=function(){t.then(c)}:r?n=function(){r(c)}:i?(e=document.createElement("i"),new i(c).observe(e,{attributes:!0}),n=function(){e.id=""}):n=function(){J.setTimeout(c,0)},u}function j(e){return m(e,C)&&e.toString().indexOf("[native")>-1&&e}function x(e,n){try{e()}catch(t){n(t)}}var E,M={},S="palikka",T=0,O="pending",D="fulfilled",F="rejected",L={asyncDeferreds:!0,asyncModules:!0},z={},A="a",C="function",P="object",q="array",I="arguments",K="number",R="string",W={}.toString,B=[].slice,G=!this==!0,H=typeof process===P&&m(process,"process"),J=H?global:window,N=b(),Q=n.prototype,U=r.prototype;Q.on=function(e,n,t){var r=this._listeners;return m(n,C)&&(r[e]=r[e]||[],r[e].push({id:++T,fn:n,ctx:t})),this},Q.one=function(e,n,t){var r=this;return r.on(e,function(e){var t=k(arguments);t[0].fn=n,r.off(e.type,e.id),n.apply(this,t)},t),r},Q.off=function(e,n){var t=this._listeners,r=t[e],i=r&&r.length;if(i)if(n)for(var o,s=m(n),u=s===K,c=s===C;i--;)o=r[i],(c&&n===o.fn||u&&n===o.id)&&r.splice(i,1);else delete t[e];return this},Q.emit=function(n,t,r){var i,o=this,s=o._listeners[n];return s&&w(k(s),function(s){m(s.fn,C)&&(i=k(t),i.unshift({type:n,id:s.id,fn:s.fn}),s.fn.apply(r!==e?r:s.ctx!==e?s.ctx:o,i))}),o},U.state=function(){return this._state},U.result=function(){return this._result},U.isAsync=function(){return this._async},U.isLocked=function(){return this._locked},U.inspect=function(){var e=this;return{state:e._state,result:e._result,locked:e._locked,async:e._async}},U.sync=function(){return this._async=!1,this},U.async=function(){return this._async=!0,this},U.resolve=function(e){var n=this;return n._state!==O||n._locked||(n._locked=!0,o(n,e)),n},U.reject=function(e){var n=this;return n._state!==O||n._locked||(n._locked=!0,u(n,e,F)),n},U.onFulfilled=function(e){return c(this,e,D)},U.onRejected=function(e){return c(this,e,F)},U.onSettled=function(e){return c(this,e)},U.then=function(e,n){return l(this,e,n)},U.spread=function(e,n){return l(this,e,n,1)},U.and=function(e,n,t){return e.unshift(this),a(e,n,t)},M.Eventizer=n,M.eventize=t,M.Deferred=r,M.defer=i,M.when=a,M.define=h,M.require=p,M.list=_,M.typeOf=m,M.nextTick=N,M.config=L,E=t(),typeof define===C&&define.amd?define([],M):typeof module===P&&module.exports?module.exports=M:J[S]=M}();