/*!
 * Palikka v1.0.0
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2016 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(e,n){"function"==typeof define&&define.amd?define([],function(){return n(e)}):"object"==typeof module&&module.exports?module.exports=n(e):e.Palikka=n(e)}(this,function(e,n){"use strict";function t(e,t,r,u){function d(e){s||(s=!0,e&&"function"==typeof e.then?e.then(f,f):f(e))}function f(n){l.ready=!0,l.value=n;for(var r=e._queues,o=r[t]=(r[t]||[]).concat(),i=0;i<o.length;i++)o[i](l)}function c(){if("function"==typeof u){var n=!1,r=function(e){if(!n){if(n=!0,"function"!=typeof e)return d;e(function(e){d(e)})}},o=function(n){return i.call(e,n)},f=u(o,r,t);n||d(f)}else d(u)}var l=this,s=!1;if(t&&"string"==typeof t||a(p.invalidModuleId),!e._modules[t]){for(var h=0;h<r.length;h++){var v=r[h],y=e._modules[v];v&&"string"==typeof v||a(p.invalidModuleId),v===t&&a(p.selfAsDep),y&&y.dependencies.indexOf(t)>-1&&a(p.circDep(t,v))}l.id=t,l.order=++e._counter,l.dependencies=r,l.ready=!1,l.value=n,e._modules[t]=l,r.length?o.call(e,r,c):c()}}function r(){this._modules={},this._queues={},this._counter=0}function o(e,n){for(var t=this,r=[].concat(e),o=r.length,i=0,u=0;u<r.length;u++){var d=r[u];d&&"string"==typeof d||a(p.invalidModuleId);var f=t._modules[d];if(f&&f.ready)++i===o&&n();else{var c=t._queues,l=c[d]=c[d]||[];l[l.length]=function(){++i===o&&n()}}}}function i(e){e&&"string"==typeof e||a(p.invalidModuleId);var n=this._modules[e];return n&&n.ready||a(p.moduleNotReady(e)),n.value}function u(e){return{id:e.id,order:e.order,dependencies:e.dependencies,ready:e.ready,value:e.value}}function d(e){for(var n="",t=e&&"function"!=typeof e?e:null,r=this._modules,o=(t?[].concat(t):Object.keys(r)).filter(function(e){return r[e]}).map(function(e){return u(r[e])}).sort(function(e,n){return e.order<n.order?-1:e.order>n.order?1:0}),i=0;i<o.length;i++){var d=o[i],a=d.ready?l:s;n+=f(d.id,null,a);for(var c=0;c<d.dependencies.length;c++){var p=d.dependencies[c],v=r[p],y=v?v.ready?l:s:h;n+=f(p,d.id,y)}}return n}function f(e,n,t){return(n?"    ":"")+v[t]+" "+e+"\n"}function a(e){throw new Error("[Palikka] "+e)}var c=new r,l="ready",s="defined",h="undefined",p={invalidModuleId:"Module id must be a non-empty string.",selfAsDep:"Module cannot have itself as a dependency.",noDefineId:".define() method must have an id.",noRequireId:".require() method must have an id.",noRequireCb:".require() method must have a callback function.",moduleNotReady:function(e){return"Required module ("+e+") is not ready."},circDep:function(e,n){return"Circular dependency between "+e+" and "+n+"."}},v={ready:"(v)",defined:"(-)",undefined:"( )"};return r.define=function(e,n,t){var o=arguments.length;return o>2?c.define(e,n,t):o>1?c.define(e,n):c.define(e),r},r.require=function(e,n){return c.require(e,n),r},r.getLog=function(e){return c.getLog(e)},r.getData=function(){return c.getData()},r.prototype.define=function(e,n,r){var o=arguments.length>2,e=[].concat(e),i=o?[].concat(n):[],r=o?r:n;e.length||a(p.noDefineId);for(var u=0;u<e.length;u++)new t(this,e[u],i,r);return this},r.prototype.require=function(e,n){var t=this;return e=[].concat(e),e.length||a(p.noRequireId),"function"!=typeof n&&a(p.noRequireCb),o.call(t,e,function(){n(function(e){return i.call(t,e)})}),t},r.prototype.getLog=function(e){return d.call(this,e)},r.prototype.getData=function(){for(var e=this._modules,n=Object.keys(e),t={},r=0;r<n.length;r++)t[n[r]]=u(e[n[r]]);return t},r});