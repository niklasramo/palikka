/*!
 * @license
 * Palikka v0.4.0
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2015 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(n){"use strict";function e(n){n=g(n,P)?n:{},this._=function(e){return e===T?n:void 0}}function t(t,r){var i=new e(r);return g(t,P)?(b(["on","one","off"],function(n){t[n]=function(e,r){return i[n](e,r),t}}),t.emit=function(e,r,o){return i.emit(e,r,o===n?t:o),t},t):i}function r(e){var t=this,r={id:++J,locked:!1,result:n,state:C,async:O.asyncDeferreds};t._=function(n){return n===T?r:void 0},g(e,K)&&e(function(n){t.resolve(n)},function(n){t.reject(n)})}function i(n){return new r(n)}function o(n,e){e===n?f(n,TypeError("A promise can not be resolved with itself.")):e instanceof r?e.onFulfilled(function(e){c(n,e)}).onRejected(function(e){f(n,e)}):g(e,K)||g(e,P)?u(n,e):c(n,e)}function u(n,e){try{var t,r=e.then;if(g(r,K))try{r.call(e,function(e){t||(t=1,o(n,e))},function(e){t||(t=1,f(n,e))})}catch(i){t||f(n,i)}else c(n,e)}catch(i){f(n,i)}}function c(n,e){var t=n._(T);t.result=e,t.state=q,x.emit(R+t.id,[e]).off(z+t.id)}function f(n,e){var t=n._(T);t.result=e,t.state=I,x.emit(z+t.id,[e]).off(R+t.id)}function s(n,e,t,r){var i=n._(T);return g(e,K)&&(i.state===t&&a(i,e),i.state===C&&x.one(r+i.id,function(){a(i,e)})),n}function a(n,e){E(function(){e(n.result)},n.async)}function l(n,e,t,r){var o,u,c=i();return n.onSettled(function(i){if(o=n.state()===q,e=o&&g(e,K)?e:0,t=!o&&g(t,K)?t:0,u=e||t||0,u||o)try{c.resolve(u?r&&g(i,W)?u.apply(this,i):u(i):i)}catch(f){c.reject(f)}else c.reject(i)}),c}function d(e,t,o){k(e,W),t=t===!0,o=o===n||o===!0;var u,c=i(),f=[],s=[],a=e.length;return a?b(e,function(n,e){n=n instanceof r?n:i().resolve(n),n.onSettled(function(){c.state()!==C||c.isLocked()||(--a,u=u||n.state()===I&&n,f[e]=n.result(),s[e]=n.inspect(),!u||!o&&a||c.reject(o?u.result():s),u||!t&&a||c.resolve(t?f[e]:f))})}):c.resolve(f),c}function h(n,e,t){var r=this,o=i().sync();r.id=n,r.dependencies=e,r.deferred=o,D[n]=r,o.onFulfilled(function(){x.emit(L+n,[r])}),y(e,function(e,r){o.resolve(g(t,K)?t.apply({id:n,dependencies:r},e):t)})}function p(n,e,t){var r,i,o=arguments.length>2;return k(n,W+"|"+H),n=g(n,W)?n:[n],o?(k(e,W+"|"+H),r=g(e,W)?e:[e]):r=[],t=o?t:e,k(t,K+"|"+P),b(n,function(n){if(k(n,H),!n)throw Error("Module must have an id.");if(D[n]instanceof h)throw Error("Module "+n+" is already defined.");if(o&&r.length&&(i=m(n,r)))throw Error("Circular dependency between "+n+" and "+i+".");new h(n,r,t)}),S}function v(n,e){return k(e,K),k(n,W+"|"+H),n=g(n,W)?n:[n],y(n,function(n,t){e.apply({dependencies:t},n)}),S}function y(n,e){var t=[],r={};b(n,function(n){k(n,H),t.push(D[n]?D[n].deferred:i(function(e){x.one(L+n,function(n,t){e(t.deferred.result())})}).sync())}),d(t)[O.asyncModules?"async":"sync"]().onFulfilled(function(t){b(n,function(n,e){r[n]=t[e]}),e(t,r)})}function m(n,e){var t=null;return b(e,function(e){var r=D[e];return r&&b(r.dependencies,function(e){return t||e!==n?void 0:(t=r.id,1)}),t?1:void 0}),t}function _(){var n,e,t={};for(e in D)n=D[e],t[e]={id:e,dependencies:w(n.dependencies),ready:n.deferred.state()===q?!0:!1,value:n.deferred.result()};return t}function g(e,t){var r=null===e?"null":e===n?"undefined":typeof e;return r=r!==P?r:N.call(e).split(" ")[1].replace("]","").toLowerCase(),U||r!==P||(r=typeof e.callee===K&&e===e.callee.arguments?B:r),t?r===t:r}function k(n,e){var t=!1,r=e.split("|");if(b(r,function(e){t=t?t:g(n,e)}),!t)throw TypeError(n+" is not "+e)}function w(n){var e=g(n);return e===W?n.slice(0):e===B?Q.call(n):[]}function b(n,e){if(g(e,K))for(var t=0,r=n.length;r>t&&!e(n[t],t);t++);return n}function j(){var n,e,t,r,i,o,u=M(X.Promise);return u?(u=u.resolve(),function(n){u.then(n)}):V?X.setImmediate||process.nextTick:(n=M(X.MutationObserver)||M(X.WebKitMutationObserver),e=1,t=function(){e=1,x.emit(A)},r=function(){e&&(e=0,i())},n?(o=document.createElement("i"),new n(t).observe(o,{attributes:!0}),i=function(){o.id=""}):i=function(){X.setTimeout(t,0)},function(n){x.one(A,n),r()})}function E(n,e){e?Y(n):n()}function M(n){return g(n,K)&&n.toString().indexOf("[native")>-1&&n}var x,F="palikka",S={},T={},O={asyncDeferreds:!0,asyncModules:!0},D={},L="a",R="b",z="c",A="d",C="pending",q="fulfilled",I="rejected",K="function",P="object",W="array",B="arguments",G="number",H="string",J=0,N={}.toString,Q=[].slice,U=!this==!0,V=typeof process===P&&g(process,"process"),X=V?global:window,Y=j(),Z=e.prototype,$=r.prototype;Z.on=function(n,e){var t=this._(T);return g(e,K)&&(t[n]=t[n]||[],t[n].push({id:++J,type:n,fn:e})),this},Z.one=function(n,e){var t=this;return t.on(n,function(n){t.off(n.type,n.id),e.apply(this,arguments)}),t},Z.off=function(n,e){var t,r,i=this._(T),o=g(e),u=o===G,c=o===K,f=i[n];if(f){for(r=f.length;r--;)t=f[r],(!e||c&&e===t.fn||u&&e===t.id)&&f.splice(r,1);f.length||delete i[n]}return this},Z.emit=function(e,t,r){var i,o=this,u=o._(T)[e];return u&&b(w(u),function(e){g(e.fn,K)&&(i=w(t),i.unshift({id:e.id,type:e.type,fn:e.fn}),e.fn.apply(r===n?o:r,i))}),o},$.state=function(){return this._(T).state},$.result=function(){return this._(T).result},$.isAsync=function(){return this._(T).async},$.isLocked=function(){return this._(T).locked},$.inspect=function(){var n=this._(T);return{state:n.state,result:n.result,locked:n.locked,async:n.async}},$.sync=function(){return this._(T).async=!1,this},$.async=function(){return this._(T).async=!0,this},$.resolve=function(n){var e=this,t=e._(T);return t.state!==C||t.locked||(t.locked=!0,o(e,n)),e},$.reject=function(n){var e=this,t=e._(T);return t.state!==C||t.locked||(t.locked=!0,f(e,n)),e},$.onFulfilled=function(n){return s(this,n,q,R)},$.onRejected=function(n){return s(this,n,I,z)},$.onSettled=function(n){return this.onFulfilled(n).onRejected(n)},$.then=function(n,e){return l(this,n,e)},$.spread=function(n,e){return l(this,n,e,1)},$.and=function(n,e,t){return n.unshift(this),d(n,e,t)},S.Eventizer=e,S.eventize=t,S.Deferred=r,S.defer=i,S.when=d,S.define=p,S.require=v,S.list=_,S.typeOf=g,S.nextTick=Y,S.config=O,x=t(),typeof define===K&&define.amd?define([],S):typeof exports===P?module.exports=S:X[F]=S}();