/*!
 * @license
 * Palikka v0.4.1
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2015 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(n){"use strict";function e(n){this._listeners=m(n,C)?n:{}}function t(n,t){var r=new e(t);return m(n,C)?(n.on=r.on,n.one=r.one,n.off=r.off,n.emit=r.emit,n._listeners=r._listeners,n):r}function r(e){var t=this;t._locked=!1,t._result=n,t._state=D,t._async=T.asyncDeferreds,t._handlers=[],m(e,A)&&e(function(n){t.resolve(n)},function(n){t.reject(n)})}function i(n){return new r(n)}function o(n,e){e===n?u(n,TypeError("A promise can not be resolved with itself."),z):e instanceof r?e.onFulfilled(function(e){u(n,e,L)}).onRejected(function(e){u(n,e,z)}):m(e,A)||m(e,C)?s(n,e):u(n,e,L)}function s(n,e){try{var t,r=e.then;if(m(r,A))try{r.call(e,function(e){t||(t=1,o(n,e))},function(e){t||(t=1,u(n,e,z))})}catch(i){t||(t=1,u(n,i,z))}else u(n,e,L)}catch(i){u(n,i,z)}}function u(n,e,t){n._result=e,n._state=t;var r=n._handlers.length;r&&w(n._handlers.splice(0,r),function(e){e.type&&e.type!==t||f(n,e.fn)})}function c(n,e,t){return m(e,A)&&(n._state===D?n._handlers.push({type:t,fn:e}):t&&n._state!==t||f(n,e)),n}function f(n,e){n._async?N(function(){e(n._result)}):e(n._result)}function l(n,e,t,r){var o,s,u=i();return n.onSettled(function(i){o=n._state===L,e=o&&m(e,A)?e:0,t=!o&&m(t,A)?t:0,s=e||t||0,s||o?x(function(){u.resolve(s?r&&m(i,P)?s.apply(r,i):s(i):i)},function(n){u.reject(n)}):u.reject(i)}),u}function a(e,t,o){g(e,P),t=t===!0,o=o===n||o===!0;var s,u=i(),c=[],f=[],l=e.length;return l?w(e,function(n,e){n=n instanceof r?n:i().resolve(n),n.onSettled(function(){u.state()!==D||u.isLocked()||(--l,s=s||n.state()===z&&n,c[e]=n.result(),f[e]=n.inspect(),!s||!o&&l||u.reject(o?s.result():f),s||!t&&l||u.resolve(t?c[e]:c))})}):u.resolve(c),u}function d(n,e,t){var r=this,o=i().sync();r.id=n,r.dependencies=e,r.deferred=o,F[n]=r,v(e,function(e,i){o.resolve(m(t,A)?t.apply({id:n,dependencies:i},e):t).onFulfilled(function(){E.emit(O+n,[r])})})}function h(n,e,t){var r,i,o=arguments.length>2;return g(n,P+"|"+I),n=m(n,P)?n:[n],o?(g(e,P+"|"+I),r=m(e,P)?e:[e]):r=[],t=o?t:e,g(t,A+"|"+C),w(n,function(n){if(g(n,I),!n)throw Error("Module must have an id.");if(F[n])throw Error("Module "+n+" is already defined.");if(o&&r.length&&(i=y(n,r)))throw Error("Circular dependency between "+n+" and "+i+".");new d(n,r,t)}),S}function p(n,e){return g(e,A),g(n,P+"|"+I),n=m(n,P)?n:[n],v(n,function(n,t){e.apply({dependencies:t},n)}),S}function v(n,e){var t=[],r={};w(n,function(n){g(n,I),t.push(F[n]?F[n].deferred:i(function(e){E.one(O+n,function(n,t){e(t.deferred.result())})}).sync())}),a(t)[T.asyncModules?"async":"sync"]().onFulfilled(function(t){w(n,function(n,e){r[n]=t[e]}),e(t,r)})}function y(n,e){var t=null;return w(e,function(e){var r=F[e];return r&&w(r.dependencies,function(e){return t||e!==n?void 0:(t=r.id,1)}),t?1:void 0}),t}function _(){var n,e,t={};for(e in F)n=F[e],t[e]={id:e,dependencies:k(n.dependencies),ready:n.deferred.state()===L?!0:!1,value:n.deferred.result()};return t}function m(e,t){var r=null===e?"null":e===n?"undefined":typeof e;return r=r!==C?r:W.call(e).split(" ")[1].replace("]","").toLowerCase(),G||r!==C||(r=typeof e.callee===A&&e===e.callee.arguments?R:r),t?r===t:r}function g(n,e){var t=!1,r=e.split("|");if(w(r,function(e){t=t?t:m(n,e)}),!t)throw TypeError(n+" is not "+e)}function k(n){var e=m(n);return e===P?n.slice(0):e===R?B.call(n):[]}function w(n,e){if(m(e,A))for(var t=0,r=n.length;r>t&&!e(n[t],t);t++);return n}function b(){var n,e,t=j(J.Promise)&&J.Promise.resolve(),r=H&&(process.nextTick||J.setImmediate),i=j(J.MutationObserver)||j(J.WebKitMutationObserver),o=[],s=0,u=function(n){return m(n,A)&&(o.push(n),s||(s=1,e())),S},c=function(){s=0,w(o.splice(0,o.length),function(n){n()})};return t?e=function(){t.then(c)}:r?e=function(){r(c)}:i?(n=document.createElement("i"),new i(c).observe(n,{attributes:!0}),e=function(){n.id=""}):e=function(){J.setTimeout(c,0)},u}function j(n){return m(n,A)&&n.toString().indexOf("[native")>-1&&n}function x(n,e){try{n()}catch(t){e(t)}}var E,M="palikka",S={},T={asyncDeferreds:!0,asyncModules:!0},F={},O="a",D="pending",L="fulfilled",z="rejected",A="function",C="object",P="array",R="arguments",q="number",I="string",K=0,W={}.toString,B=[].slice,G=!this==!0,H=typeof process===C&&m(process,"process"),J=H?global:window,N=b(),Q=e.prototype,U=r.prototype;Q.on=function(n,e,t){var r=this._listeners;return m(e,A)&&(r[n]=r[n]||[],r[n].push({id:++K,fn:e,ctx:t})),this},Q.one=function(n,e,t){var r=this;return r.on(n,function(n){var t=k(arguments);t[0].fn=e,r.off(n.type,n.id),e.apply(this,t)},t),r},Q.off=function(n,e){var t=this._listeners,r=t[n],i=r&&r.length;if(i)if(e)for(var o,s=m(e),u=s===q,c=s===A;i--;)o=r[i],(c&&e===o.fn||u&&e===o.id)&&r.splice(i,1);else delete t[n];return this},Q.emit=function(e,t,r){var i,o=this,s=o._listeners[e];return s&&w(k(s),function(s){m(s.fn,A)&&(i=k(t),i.unshift({type:e,id:s.id,fn:s.fn}),s.fn.apply(r!==n?r:s.ctx!==n?s.ctx:o,i))}),o},U.state=function(){return this._state},U.result=function(){return this._result},U.isAsync=function(){return this._async},U.isLocked=function(){return this._locked},U.inspect=function(){var n=this;return{state:n._state,result:n._result,locked:n._locked,async:n._async}},U.sync=function(){return this._async=!1,this},U.async=function(){return this._async=!0,this},U.resolve=function(n){var e=this;return e._state!==D||e._locked||(e._locked=!0,o(e,n)),e},U.reject=function(n){var e=this;return e._state!==D||e._locked||(e._locked=!0,u(e,n,z)),e},U.onFulfilled=function(n){return c(this,n,L)},U.onRejected=function(n){return c(this,n,z)},U.onSettled=function(n){return c(this,n)},U.then=function(n,e){return l(this,n,e)},U.spread=function(n,e){return l(this,n,e,1)},U.and=function(n,e,t){return n.unshift(this),a(n,e,t)},S.Eventizer=e,S.eventize=t,S.Deferred=r,S.defer=i,S.when=a,S.define=h,S.require=p,S.list=_,S.typeOf=m,S.nextTick=N,S.config=T,E=t(),typeof define===A&&define.amd?define([],S):typeof exports===C?module.exports=S:J[M]=S}();