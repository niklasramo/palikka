/*!
 * @license
 * Palikka v0.4.1
 * https://github.com/niklasramo/palikka
 * Copyright (c) 2015 Niklas Rämö <inramo@gmail.com>
 * Released under the MIT license
 */
!function(e){"use strict";function n(e){e=g(e,P)?e:{},this._=function(n){return n===T?e:void 0}}function t(t,r){var i=new n(r);return g(t,P)?(b(["on","one","off"],function(e){t[e]=function(n,r){return i[e](n,r),t}}),t.emit=function(n,r,o){return i.emit(n,r,o===e?t:o),t},t):i}function r(n){var r=this,i={locked:!1,result:e,state:C,async:O.asyncDeferreds,e:t()};r._=function(e){return e===T?i:void 0},g(n,K)&&n(function(e){r.resolve(e)},function(e){r.reject(e)})}function i(e){return new r(e)}function o(e,n){n===e?s(e,TypeError("A promise can not be resolved with itself.")):n instanceof r?n.onFulfilled(function(n){c(e,n)}).onRejected(function(n){s(e,n)}):g(n,K)||g(n,P)?u(e,n):c(e,n)}function u(e,n){try{var t,r=n.then;if(g(r,K))try{r.call(n,function(n){t||(t=1,o(e,n))},function(n){t||(t=1,s(e,n))})}catch(i){t||s(e,i)}else c(e,n)}catch(i){s(e,i)}}function c(e,n){var t=e._(T);t.result=n,t.state=q,t.e.emit(R),delete t.e}function s(e,n){var t=e._(T);t.result=n,t.state=I,t.e.emit(z),delete t.e}function f(e,n,t,r){var i=e._(T);return g(n,K)&&(i.state===t&&l(i,n),i.state===C&&i.e.on(r,function(){l(i,n)})),e}function l(e,n){E(function(){n(e.result)},e.async)}function a(e,n,t,r){var o,u,c=i();return e.onSettled(function(i){if(o=e.state()===q,n=o&&g(n,K)?n:0,t=!o&&g(t,K)?t:0,u=n||t||0,u||o)try{c.resolve(u?r&&g(i,W)?u.apply(this,i):u(i):i)}catch(s){c.reject(s)}else c.reject(i)}),c}function d(n,t,o){k(n,W),t=t===!0,o=o===e||o===!0;var u,c=i(),s=[],f=[],l=n.length;return l?b(n,function(e,n){e=e instanceof r?e:i().resolve(e),e.onSettled(function(){c.state()!==C||c.isLocked()||(--l,u=u||e.state()===I&&e,s[n]=e.result(),f[n]=e.inspect(),!u||!o&&l||c.reject(o?u.result():f),u||!t&&l||c.resolve(t?s[n]:s))})}):c.resolve(s),c}function h(e,n,t){var r=this,o=i().sync();r.id=e,r.dependencies=n,r.deferred=o,D[e]=r,o.onFulfilled(function(){x.emit(L+e,[r])}),y(n,function(n,r){o.resolve(g(t,K)?t.apply({id:e,dependencies:r},n):t)})}function p(e,n,t){var r,i,o=arguments.length>2;return k(e,W+"|"+H),e=g(e,W)?e:[e],o?(k(n,W+"|"+H),r=g(n,W)?n:[n]):r=[],t=o?t:n,k(t,K+"|"+P),b(e,function(e){if(k(e,H),!e)throw Error("Module must have an id.");if(D[e]instanceof h)throw Error("Module "+e+" is already defined.");if(o&&r.length&&(i=m(e,r)))throw Error("Circular dependency between "+e+" and "+i+".");new h(e,r,t)}),S}function v(e,n){return k(n,K),k(e,W+"|"+H),e=g(e,W)?e:[e],y(e,function(e,t){n.apply({dependencies:t},e)}),S}function y(e,n){var t=[],r={};b(e,function(e){k(e,H),t.push(D[e]?D[e].deferred:i(function(n){x.one(L+e,function(e,t){n(t.deferred.result())})}).sync())}),d(t)[O.asyncModules?"async":"sync"]().onFulfilled(function(t){b(e,function(e,n){r[e]=t[n]}),n(t,r)})}function m(e,n){var t=null;return b(n,function(n){var r=D[n];return r&&b(r.dependencies,function(n){return t||n!==e?void 0:(t=r.id,1)}),t?1:void 0}),t}function _(){var e,n,t={};for(n in D)e=D[n],t[n]={id:n,dependencies:w(e.dependencies),ready:e.deferred.state()===q?!0:!1,value:e.deferred.result()};return t}function g(n,t){var r=null===n?"null":n===e?"undefined":typeof n;return r=r!==P?r:N.call(n).split(" ")[1].replace("]","").toLowerCase(),U||r!==P||(r=typeof n.callee===K&&n===n.callee.arguments?B:r),t?r===t:r}function k(e,n){var t=!1,r=n.split("|");if(b(r,function(n){t=t?t:g(e,n)}),!t)throw TypeError(e+" is not "+n)}function w(e){var n=g(e);return n===W?e.slice(0):n===B?Q.call(e):[]}function b(e,n){if(g(n,K))for(var t=0,r=e.length;r>t&&!n(e[t],t);t++);return e}function j(){var e,n,t,r,i,o,u,c=M(X.Promise);return c?(c=c.resolve(),u=function(e){c.then(e)}):V?u=X.setImmediate||process.nextTick:(e=M(X.MutationObserver)||M(X.WebKitMutationObserver),n=1,t=function(){n=1,x.emit(A)},r=function(){n&&(n=0,i())},e?(o=document.createElement("i"),new e(t).observe(o,{attributes:!0}),i=function(){o.id=""}):i=function(){X.setTimeout(t,0)},u=function(e){x.one(A,e),r()}),function(e){return g(e,K)&&u(e),S}}function E(e,n){n?Y(e):e()}function M(e){return g(e,K)&&e.toString().indexOf("[native")>-1&&e}var x,F="palikka",S={},T={},O={asyncDeferreds:!0,asyncModules:!0},D={},L="a",R="b",z="c",A="d",C="pending",q="fulfilled",I="rejected",K="function",P="object",W="array",B="arguments",G="number",H="string",J=0,N={}.toString,Q=[].slice,U=!this==!0,V=typeof process===P&&g(process,"process"),X=V?global:window,Y=j(),Z=n.prototype,$=r.prototype;Z.on=function(e,n){var t=this._(T);return g(n,K)&&(t[e]=t[e]||[],t[e].push({id:++J,type:e,fn:n})),this},Z.one=function(e,n){var t=this;return t.on(e,function(e){t.off(e.type,e.id),n.apply(this,arguments)}),t},Z.off=function(e,n){var t,r,i,o,u,c=this._(T),s=c[e];if(s){if(n)for(t=g(n),r=t===G,i=t===K,u=s.length;u--;)o=s[u],(i&&n===o.fn||r&&n===o.id)&&s.splice(u,1);n&&s.length||delete c[e]}return this},Z.emit=function(n,t,r){var i,o=this,u=o._(T)[n];return u&&b(w(u),function(n){g(n.fn,K)&&(i=w(t),i.unshift({id:n.id,type:n.type,fn:n.fn}),n.fn.apply(r===e?o:r,i))}),o},$.state=function(){return this._(T).state},$.result=function(){return this._(T).result},$.isAsync=function(){return this._(T).async},$.isLocked=function(){return this._(T).locked},$.inspect=function(){var e=this._(T);return{state:e.state,result:e.result,locked:e.locked,async:e.async}},$.sync=function(){return this._(T).async=!1,this},$.async=function(){return this._(T).async=!0,this},$.resolve=function(e){var n=this,t=n._(T);return t.state!==C||t.locked||(t.locked=!0,o(n,e)),n},$.reject=function(e){var n=this,t=n._(T);return t.state!==C||t.locked||(t.locked=!0,s(n,e)),n},$.onFulfilled=function(e){return f(this,e,q,R)},$.onRejected=function(e){return f(this,e,I,z)},$.onSettled=function(e){return this.onFulfilled(e).onRejected(e)},$.then=function(e,n){return a(this,e,n)},$.spread=function(e,n){return a(this,e,n,1)},$.and=function(e,n,t){return e.unshift(this),d(e,n,t)},S.Eventizer=n,S.eventize=t,S.Deferred=r,S.defer=i,S.when=d,S.define=p,S.require=v,S.list=_,S.typeOf=g,S.nextTick=Y,S.config=O,x=t(),typeof define===K&&define.amd?define([],S):typeof exports===P?module.exports=S:X[F]=S}();